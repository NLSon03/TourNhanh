@model TourNhanh.Models.Booking

@{
    ViewData["Title"] = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Create</h2>

<h4>Booking</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form asp-action="Create" method="post">
            <input type="hidden" name="tourId" value="@ViewBag.TourId" />
            <div class="form-group">
                <label for="quantity">Number of People</label>
                <input type="number" name="quantity" id="quantity" class="form-control" required
                       min="1" max="@ViewBag.MaxCap" oninput="validateQuantity()" />
            </div>
            <div class="form-group">
                <label for="paymentMethod">Payment Method</label>
                <select name="paymentMethod" id="paymentMethod" class="form-control" required>
                    <option value="online">Thanh toán trực tuyến</option>
                    <option value="offline">Thanh toán trực tiếp</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Amount" class="control-label">Amount</label>
                <span id="Amount" class="form-control"></span>
            </div>
            <div class="form-group">
                <label for="note">Note</label>
                <textarea name="note" id="note" class="form-control"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Book Now</button>
        </form>
    </div>
</div>

<div>
    <a asp-controller="Tour" asp-action="Details" asp-route-id="@ViewBag.TourId">Back to List</a>
</div>


@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

<script>


   
    const price = @ViewBag.Price;
    const maxCap = @ViewBag.RemainingSlots;

    console.log(price, maxCap)

    function validateQuantity() {
        const quantityInput = document.getElementById('quantity');
        let quantity = parseInt(quantityInput.value);

        // Ensure quantity is within the valid range
        if (quantity < 1) {
            quantity = 1;
        } else if (quantity > maxCap) {
            quantity = maxCap;
        }

        // Update the input value to ensure it's within the range
        quantityInput.value = quantity;

        // Calculate and display the amount
        calculateAmount(quantity);
    }

    function calculateAmount(quantity) {
        const amount = price * quantity;
        document.getElementById('Amount').innerText = amount;
    }

    // Initialize the amount on page load
    document.addEventListener('DOMContentLoaded', function () {
        validateQuantity();
    });
</script>
@* 
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

    let paymentMethodValue = 0;
    document.getElementById('paymentMethod').addEventListener('change', function () {
        paymentMethodValue = this.value;
        console.log("paymentMethodValue", this.value)
    })

    let noteValue  = 0;

    document.getElementById('note').addEventListener('change', function () {
        noteValue = this.value;
        console.log("noteValue", this.value)
    })


    let amount = 0;
    document.getElementById('Amount').addEventListener('change', function () {
        amount = this.value;
        console.log( "amount" ,this.value)
    })


    let quantity = 0;
    document.getElementById('quantity').addEventListener('change', function () {
        quantity = this.value;
        console.log("quantity", this.value)
    })

    let idTourValue = document.getElementById("tourID").value;
    console.log("idTourValue", idTourValue)

    



    $(document).ready(function () {
        $('#backToListBtn').on('click', function (e) {
            e.preventDefault(); // Ngăn chặn hành động mặc định của nút

            var tourId = idTourValue;
            var quantity = $("#quantity").value;
                var paymentMethod = paymentMethodValue  /*phupng thuc*/;
            var note = noteValue /* Lấy giá trị note từ form hoặc biến phù hợp */;

            $.ajax({
                type: 'POST',
                url: '@Url.Action("Create", "Tour")',
                data: {
                    tourId: tourId,
                    quantity: quantity,
                    paymentMethod: paymentMethod,
                    note: note
                },
                success: function (response) {
                   console.log("thanh cong")
                    // Xử lý phản hồi từ server nếu cần thiết
                },
                error: function (xhr, status, error) {
                    // Xử lý lỗi nếu có
                    console.log("loi!!!!")

                }
            });
        });
    });
</script>
 *@