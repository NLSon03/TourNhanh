@model TourNhanh.Models.Booking

@{
    ViewData["Title"] = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Create</h2>

<h4>Booking</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form asp-action="Create" method="post">
            <input type="hidden" name="tourId" value="@ViewBag.TourId" />
            <div class="form-group">
                <label for="quantity">Number of People</label>
                <input type="number" name="quantity" id="quantity" class="form-control" required
                       min="1" max="@ViewBag.MaxCap" oninput="validateQuantity()" />
            </div>
            <div class="form-group">
                <label for="paymentMethod">Payment Method</label>
                <input type="text" name="paymentMethod" id="paymentMethod" class="form-control" required />
            </div>
            <div class="form-group">
                <label for="Amount" class="control-label">Amount</label>
                <span id="Amount" class="form-control"></span>
            </div>
            <div class="form-group">
                <label for="note">Note</label>
                <textarea name="note" id="note" class="form-control"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Book Now</button>
        </form>
    </div>
</div>

<div>
    <a asp-controller="Tour" asp-action="Details" asp-route-id="@ViewBag.TourId">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

<script>
    const price = @ViewBag.Price;
    const maxCap = @ViewBag.RemainingSlots;

    function validateQuantity() {
        const quantityInput = document.getElementById('quantity');
        let quantity = parseInt(quantityInput.value);

        // Ensure quantity is within the valid range
        if (quantity < 1) {
            quantity = 1;
        } else if (quantity > maxCap) {
            quantity = maxCap;
        }

        // Update the input value to ensure it's within the range
        quantityInput.value = quantity;

        // Calculate and display the amount
        calculateAmount(quantity);
    }

    function calculateAmount(quantity) {
        const amount = price * quantity;
        document.getElementById('Amount').innerText = amount;
    }

    // Initialize the amount on page load
    document.addEventListener('DOMContentLoaded', function () {
        validateQuantity();
    });
</script>